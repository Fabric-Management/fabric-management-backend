{
  "info": {
    "_postman_id": "fabric-mgmt-mm-001",
    "name": "Fabric Management - Modular Monolith API",
    "description": "Complete API collection for Fabric Management System\n\nModules:\n- Health & Info\n- Onboarding (Sales-Led + Self-Service)\n- Authentication\n- Company Management\n- User Management\n- Subscription Management\n- Policy Management\n- Audit Logs\n- Development Tools (Cleanup)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "üéØ Health & Info",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/health",
              "host": ["{{base_url}}"],
              "path": ["api", "health"]
            }
          }
        },
        {
          "name": "Application Info",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/info",
              "host": ["{{base_url}}"],
              "path": ["api", "info"]
            }
          }
        },
        {
          "name": "Actuator Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/actuator/health",
              "host": ["{{base_url}}"],
              "path": ["actuator", "health"]
            }
          }
        }
      ]
    },
    {
      "name": "üöÄ Onboarding (NEW)",
      "item": [
        {
          "name": "Sales-Led Tenant Creation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.companyId) {",
                  "    pm.environment.set('company_id', jsonData.data.companyId);",
                  "    pm.environment.set('tenant_id', jsonData.data.tenantId);",
                  "    pm.environment.set('registration_token', jsonData.data.registrationToken);",
                  "    console.log('Setup URL:', jsonData.data.setupUrl);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"companyName\": \"Akkayalar Tekstil Dokuma San. Tic. Ltd.Sti\",\n  \"taxId\": \"4420543162\",\n  \"companyType\": \"WEAVER\",\n  \"address\": \"Organize Sanayi B√∂lgesi\",\n  \"city\": \"Kahramanmara≈ü\",\n  \"country\": \"Turkey\",\n  \"phoneNumber\": \"+90 344 502 1010\",\n  \"companyEmail\": \"info@akkayalartekstil.com.tr\",\n  \"adminFirstName\": \"Fatih\",\n  \"adminLastName\": \"Akkaya\",\n  \"adminContact\": \"fatih@akkayalartekstil.com.tr\",\n  \"adminDepartment\": \"management\",\n  \"selectedOS\": [\"LoomOS\", \"AccountOS\"],\n  \"trialDays\": 90\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/admin/onboarding/tenant",
              "host": ["{{base_url}}"],
              "path": ["api", "admin", "onboarding", "tenant"]
            }
          }
        },
        {
          "name": "Self-Service Signup",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "console.log('Signup initiated. Check email for setup link.');",
                  "// Note: In real flow, user receives email with token + code"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"companyName\": \"Test √ñrme Fabrikasƒ±\",\n  \"taxId\": \"9876543210\",\n  \"companyType\": \"KNITTER\",\n  \"firstName\": \"Test\",\n  \"lastName\": \"User\",\n  \"email\": \"test@testcompany.com\",\n  \"selectedOS\": [\"KnitOS\"],\n  \"acceptedTerms\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/public/signup",
              "host": ["{{base_url}}"],
              "path": ["api", "public", "signup"]
            }
          }
        },
        {
          "name": "Setup Password (Token Only - All Flows)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.accessToken) {",
                  "    pm.environment.set('access_token', jsonData.data.accessToken);",
                  "    pm.environment.set('refresh_token', jsonData.data.refreshToken);",
                  "    console.log('Auto-login successful!');",
                  "    console.log('Needs onboarding:', jsonData.data.needsOnboarding);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"{{registration_token}}\",\n  \"password\": \"SecurePass123!\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/setup-password",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "setup-password"]
            }
          }
        }
      ]
    },
    {
      "name": "üîê Authentication",
      "item": [
        {
          "name": "Register - Check Eligibility",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"contactValue\": \"fatih@akkayalartekstil.com.tr\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/register/check",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "register", "check"]
            }
          }
        },
        {
          "name": "Register - Verify & Complete",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.accessToken) {",
                  "    pm.environment.set('access_token', jsonData.data.accessToken);",
                  "    pm.environment.set('refresh_token', jsonData.data.refreshToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"contactValue\": \"fatih@akkayalartekstil.com.tr\",\n  \"code\": \"123456\",\n  \"password\": \"SecurePass123!\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/register/verify",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "register", "verify"]
            }
          }
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.accessToken) {",
                  "    pm.environment.set('access_token', jsonData.data.accessToken);",
                  "    pm.environment.set('refresh_token', jsonData.data.refreshToken);",
                  "    console.log('Login successful!');",
                  "    console.log('Needs onboarding:', jsonData.data.needsOnboarding);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"contactValue\": \"fatih@akkayalartekstil.com.tr\",\n  \"password\": \"SecurePass123!\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/login",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "login"]
            }
          }
        }
      ]
    },
    {
      "name": "üè¢ Company Management",
      "item": [
        {
          "name": "Create Company",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.id) {",
                  "    pm.environment.set('company_id', jsonData.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"companyName\": \"Akkayalar Tekstil ƒ∞stanbul ≈ûubesi\",\n  \"taxId\": \"1234567890\",\n  \"companyType\": \"WEAVER\",\n  \"city\": \"ƒ∞stanbul\",\n  \"country\": \"Turkey\",\n  \"email\": \"istanbul@akkayalartekstil.com.tr\",\n  \"phoneNumber\": \"+90 212 123 4567\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/common/companies",
              "host": ["{{base_url}}"],
              "path": ["api", "common", "companies"]
            }
          }
        },
        {
          "name": "Get All Companies",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/common/companies",
              "host": ["{{base_url}}"],
              "path": ["api", "common", "companies"]
            }
          }
        },
        {
          "name": "Get Tenant Companies Only",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/common/companies/tenants",
              "host": ["{{base_url}}"],
              "path": ["api", "common", "companies", "tenants"]
            }
          }
        },
        {
          "name": "Get Companies by Type",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/common/companies/type/WEAVER",
              "host": ["{{base_url}}"],
              "path": ["api", "common", "companies", "type", "WEAVER"]
            }
          }
        },
        {
          "name": "Get Company Subscriptions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/common/companies/{{company_id}}/subscriptions",
              "host": ["{{base_url}}"],
              "path": [
                "api",
                "common",
                "companies",
                "{{company_id}}",
                "subscriptions"
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üë§ User Management",
      "item": [
        {
          "name": "Create User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Ahmet\",\n  \"lastName\": \"Yƒ±lmaz\",\n  \"contactValue\": \"ahmet@akkayalartekstil.com.tr\",\n  \"contactType\": \"EMAIL\",\n  \"companyId\": \"{{company_id}}\",\n  \"department\": \"production\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/common/users",
              "host": ["{{base_url}}"],
              "path": ["api", "common", "users"]
            }
          }
        },
        {
          "name": "Get All Users",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/common/users",
              "host": ["{{base_url}}"],
              "path": ["api", "common", "users"]
            }
          }
        }
      ]
    },
    {
      "name": "üìú Policy Management",
      "item": [
        {
          "name": "Create Policy",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"policyId\": \"fabric.material.create\",\n  \"resource\": \"fabric.material\",\n  \"action\": \"create\",\n  \"priority\": 100,\n  \"effect\": \"ALLOW\",\n  \"description\": \"Allow material creation for planners\",\n  \"conditions\": {\n    \"roles\": [\"PLANNER\", \"ADMIN\"],\n    \"departments\": [\"production\"]\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/common/policies",
              "host": ["{{base_url}}"],
              "path": ["api", "common", "policies"]
            }
          }
        },
        {
          "name": "Get All Policies",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/common/policies",
              "host": ["{{base_url}}"],
              "path": ["api", "common", "policies"]
            }
          }
        }
      ]
    },
    {
      "name": "üìä Audit Logs",
      "item": [
        {
          "name": "Get Audit Logs",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/common/audit/logs?page=0&size=20",
              "host": ["{{base_url}}"],
              "path": ["api", "common", "audit", "logs"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "20"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üß™ Development Tools (Cleanup)",
      "item": [
        {
          "name": "‚ö†Ô∏è Reset All Data (Development Only)",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/dev/reset-all",
              "host": ["{{base_url}}"],
              "path": ["api", "dev", "reset-all"]
            }
          }
        },
        {
          "name": "‚ö†Ô∏è Clean Expired Tokens",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/dev/clean-tokens",
              "host": ["{{base_url}}"],
              "path": ["api", "dev", "clean-tokens"]
            }
          }
        },
        {
          "name": "‚ö†Ô∏è Clean Verification Codes",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/dev/clean-codes",
              "host": ["{{base_url}}"],
              "path": ["api", "dev", "clean-codes"]
            }
          }
        },
        {
          "name": "Database Stats",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/dev/stats",
              "host": ["{{base_url}}"],
              "path": ["api", "dev", "stats"]
            }
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "refresh_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "company_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "tenant_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "registration_token",
      "value": "",
      "type": "string"
    }
  ]
}
